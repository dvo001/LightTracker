{% extends "base.html" %}
{% block content %}
<h1>Live Monitor</h1>

<div class="grid2">
  <div class="card">
    <div class="card-title">Tracking</div>
    <div class="muted">
      Phase-1: Positions werden aus <code>/api/v1/tracking/position/{tag_mac}</code> gelesen.
      Setze <code>tracking.tag_mac</code> in Settings oder trage Tag unten ein.
    </div>

    <div class="formgrid" style="margin-top:10px;">
      <label>tag_mac
        <input id="live_tag_mac" placeholder="leer = settings/tracking/tags" />
      </label>
      <label>poll_ms
        <input id="live_poll_ms" type="number" value="300" min="50" />
      </label>
    </div>

    <div class="kv" style="margin-top:10px;">
      <div class="k">System State</div><div class="v" id="live_state">…</div>
      <div class="k">Tracking State</div><div class="v" id="live_tracking">…</div>
      <div class="k">Age (ms)</div><div class="v" id="live_age">…</div>
      <div class="k">Pos (cm)</div><div class="v" id="live_pos">…</div>
    </div>

    <div class="row">
      <button class="btn primary" onclick="ltLiveStart()">Start Poll</button>
      <button class="btn" onclick="ltLiveStop()">Stop Poll</button>
      <button class="btn" onclick="ltLiveTick()">Tick</button>
    </div>
    <div class="row" style="margin-top:6px;">
      <button class="btn danger" onclick="ltSetSystemState('SETUP','live_out')">Stop LIVE</button>
      <button class="btn" onclick="ltSetSystemState('SAFE','live_out')">SAFE</button>
      <button class="btn" onclick="ltSetSystemState('LIVE','live_out')">LIVE</button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Licht (RGB)</div>
    <div class="formgrid">
      <label>Fixture
        <select id="live_patch_id"></select>
      </label>
    </div>
    <div class="formgrid" style="margin-top:10px;">
      <label>Dimmer
        <input id="live_dim" type="range" min="0" max="255" value="255" oninput="ltLiveScheduleColor()" />
        <span class="muted" id="live_dim_val">255</span>
      </label>
      <label>Rot
        <input id="live_r" type="range" min="0" max="255" value="0" oninput="ltLiveScheduleColor()" />
        <span class="muted" id="live_r_val">0</span>
      </label>
      <label>Grün
        <input id="live_g" type="range" min="0" max="255" value="0" oninput="ltLiveScheduleColor()" />
        <span class="muted" id="live_g_val">0</span>
      </label>
      <label>Blau
        <input id="live_b" type="range" min="0" max="255" value="0" oninput="ltLiveScheduleColor()" />
        <span class="muted" id="live_b_val">0</span>
      </label>
    </div>
    <div class="row" style="margin-top:6px;">
      <button class="btn" onclick="ltLiveBlackout()">Blackout</button>
    </div>
  </div>

  <div class="card">
    <div class="card-title">Payload</div>
    <pre class="pre" id="live_out"></pre>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  ltRefreshFooterState();
  ltLiveLoadPatches();
});
</script>
{% endblock %}
