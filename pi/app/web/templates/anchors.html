{% extends "base.html" %}
{% block content %}
<h1>Anchors</h1>

<div class="grid2">
  <div class="card">
    <div class="card-title">Anchor Position setzen (SETUP only)</div>
    <form onsubmit="ltSetAnchorPosition(event)">
      <div class="formgrid">
        <label>MAC <span class="req">*</span>
          <input id="anc_mac" required placeholder="AA:BB:CC:DD:EE:FF" />
        </label>
        <label>Alias
          <input id="anc_alias" maxlength="10" placeholder="z.B. Anchor 1" />
        </label>
        <label>X (cm) <span class="req">*</span>
          <input id="anc_x" type="number" required value="0" />
        </label>
        <label>Y (cm) <span class="req">*</span>
          <input id="anc_y" type="number" required value="0" />
        </label>
        <label>Z (cm) <span class="req">*</span>
          <input id="anc_z" type="number" required value="0" />
        </label>
      </div>
      <div class="row">
        <button class="btn primary" type="submit">Save Position</button>
        <button class="btn" type="button" onclick="ltAnchorProvisionFromForm()">Provision (ESP-NOW)</button>
        <button class="btn" type="button" onclick="ltAnchorResetForm()">Neuer Anchor</button>
      </div>
    </form>
    <pre class="pre" id="anchors_form_out"></pre>
  </div>

  <div class="card">
    <div class="card-title">Hinweis</div>
    <div class="muted">
      Phase-1 hat kein <code>GET /anchors</code> und kein Anchor-List Endpoint.
      Aktuell kannst du Positionen setzen; Anzeige kommt in Phase-2 (Devices/Anchors List).
    </div>
  </div>

  <div class="card">
    <div class="card-title">Antenna Calibration (Anchor)</div>
    <div class="muted">
      Setzt <code>antenna_delay</code> via <code>POST /api/v1/devices/{mac}/apply-settings</code>.
    </div>
    <div class="formgrid" style="margin-top:10px;">
      <label>MAC <span class="req">*</span>
        <input id="anc_ant_mac" required placeholder="AA:BB:CC:DD:EE:FF" />
      </label>
      <label>antenna_delay <span class="req">*</span>
        <input id="anc_ant_delay" type="number" step="1" placeholder="z.B. 16384" />
      </label>
    </div>
    <div class="row">
      <button class="btn primary" type="button" onclick="ltApplyAnchorAntennaDelay()">Send</button>
    </div>
    <div class="muted" style="margin-top:8px;">Tipp: -1 loescht den gespeicherten Wert.</div>
    <pre class="pre" id="anc_ant_out"></pre>
  </div>
</div>

<div class="card" style="margin-top:15px;">
  <div class="card-title">Anchor Liste</div>
  <div class="row" style="margin-bottom:8px;">
    <button class="btn" onclick="ltLoadAnchors()">Reload</button>
  </div>
  <div class="tablewrap">
    <table class="tbl">
      <thead>
        <tr>
          <th>MAC</th>
          <th>Alias</th>
          <th>Idx</th>
          <th>Last Seen</th>
          <th>X (cm)</th>
          <th>Y (cm)</th>
          <th>Z (cm)</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody id="anchors_tbody"><tr><td colspan="8" class="muted">ladeâ€¦</td></tr></tbody>
    </table>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener("DOMContentLoaded", () => {
  ltRefreshFooterState();
  ltLoadSystemDefaults();
  ltLoadAnchors();
  ltAttachMacFormatter(document.getElementById("anc_mac"));
  ltAttachMacFormatter(document.getElementById("anc_ant_mac"));
});
</script>
{% endblock %}
